{% load static %}
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BI可视化分析 - {{ table_name }}</title>

    <!-- Bokeh CSS -->
    <link rel="stylesheet" href="https://cdn.pydata.org/bokeh/release/bokeh-3.8.0.min.css" type="text/css" />
    <link rel="stylesheet" href="https://cdn.pydata.org/bokeh/release/bokeh-widgets-3.8.0.min.css" type="text/css" />
    <link rel="stylesheet" href="https://cdn.pydata.org/bokeh/release/bokeh-tables-3.8.0.min.css" type="text/css" />

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f7fa; }
        .bi-header { background: #fff; padding: 12px 20px; border-bottom: 1px solid #e4e7ed; display: flex; justify-content: space-between; align-items: center; }
        .bi-title { font-size: 18px; font-weight: 600; color: #303133; }
        .bi-info { font-size: 13px; color: #606266; margin-left: 20px; }
        .bi-back { padding: 8px 16px; background: #409eff; color: #fff; text-decoration: none; border-radius: 4px; font-size: 14px; }
        .bi-back:hover { background: #66b1ff; }
        .info-badge { display: inline-block; padding: 4px 12px; background: #ecf5ff; color: #409eff; border-radius: 4px; font-size: 12px; margin-right: 8px; }
        .bi-container { width: 100%; min-height: calc(100vh - 60px); background: #fff; overflow-x: auto; }
        .bk-root { width: 100% !important; }
    </style>
</head>
<body>
    <div class="bi-header">
        <div>
            <span class="bi-title">BI可视化分析 - {{ table_name }}</span>
            {% if chart_info %}
                <span class="bi-info">
                    <span class="info-badge">程序: {{ chart_info.program_name }}</span>
                    <span class="info-badge">数据: {{ chart_info.data_count }} 条</span>
                    {% if chart_info.energy_count > 0 %}
                        <span class="info-badge">能耗: {{ chart_info.energy_count }} 条</span>
                    {% endif %}
                </span>
            {% endif %}
        </div>
        <a href="javascript:history.back()" class="bi-back">返回</a>
    </div>

    <div class="bi-container">
        {{ bokeh_div|safe }}
    </div>

    <!-- Bokeh JS -->
    <script src="https://cdn.pydata.org/bokeh/release/bokeh-3.8.0.min.js"></script>
    <script src="https://cdn.pydata.org/bokeh/release/bokeh-widgets-3.8.0.min.js"></script>
    <script src="https://cdn.pydata.org/bokeh/release/bokeh-tables-3.8.0.min.js"></script>
    <script src="https://cdn.pydata.org/bokeh/release/bokeh-gl-3.8.0.min.js"></script>

    <!-- 图表脚本 - 直接输出，不包装在其他script标签中 -->
    {{ bokeh_script|safe }}
</body>
</html>
